<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=3b1ea14f0e4b9602ac90929571ec4593591de56a">

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>DEseq_and_heatmap | USF Omics Hub</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="DEseq_and_heatmap" />
<meta name="author" content="Chengqi(Charley) Wang" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="USF Omics Hub official github-repository: your landing-spot for finding our USF Genomics community-resources." />
<meta property="og:description" content="USF Omics Hub official github-repository: your landing-spot for finding our USF Genomics community-resources." />
<link rel="canonical" href="http://localhost:4000/R_training/DEseq_and_heatmap.Rmd" />
<meta property="og:url" content="http://localhost:4000/R_training/DEseq_and_heatmap.Rmd" />
<meta property="og:site_name" content="USF Omics Hub" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Chengqi(Charley) Wang"},"headline":"DEseq_and_heatmap","description":"USF Omics Hub official github-repository: your landing-spot for finding our USF Genomics community-resources.","@type":"WebPage","url":"http://localhost:4000/R_training/DEseq_and_heatmap.Rmd","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <h1>usfomicshub.github.io</h1>
        <h2>USF Omics Hub official github-repository: your landing-spot for finding our USF Genomics community-resources.</h2>

        <section id="downloads">
          
          <a href="https://github.com/usfomicshub/usfomicshub.github.io" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        *date: 2/1/2020*
<br/><br/>

####load the txt count data
```{r}
df      <- read.table('~/Documents/work/paper_write/genome_training/R_training/vehicle_drug_feature_counts.txt',
                 header = T, sep = '\t', row.names = 1)

df      <- df[,6:9]
```
<br/><br/>

####check the distribution
```{r}
par(mfrow = c(2,2), mar = c(4,4,1,1))
print( apply(df, 2, function(x) quantile(as.numeric(x))) )
log1 <- apply(df, 2, function(x) {hist(log2(x), breaks = 100)})
```
<br/><br/>

#####Pick up the gene with expression bigger than 2^4
```{r}
idExp <- apply(df, 1, function(x) any(x > 16))
dfExp <- df[idExp, ]
print(dim(dfExp))
```
<br/><br/>

####build DESeq class
```{r, message = F}
library(DESeq)
```
```{r}
condition<- c('c','c', 't', 't')
cds      <- newCountDataSet( dfExp, condition )
```

<br/><br/>

####Differential expression gene calling
```{r}
##normalize the data, extract the size factor for each assay
cds      <- estimateSizeFactors(cds)
head( counts( cds, normalized=TRUE ) )
##estimate the background gene expression 
cds      <- estimateDispersions( cds )

##estimate the background distribution
plotDispEsts(cds)
##p-value fit
res        <- nbinomTest( cds, 'c', 't' )
plotMA(res)
```
<br/><br/>

####Differential expression gene extraction and visulation
```{r}
## extract the genes with adjP < 0.0001
resSig = res[ which(res$padj < 0.0001), ]
dim(resSig)

norData <- counts( cds, normalized=TRUE )
sigNorData <- norData[which(res$padj < 0.0001),]
save(sigNorData, resSig,
     file = 'deseq.sig.R')


##extract normalized data
norDF           <- counts( cds, normalized=TRUE )
heatMapDf       <- norDF[(rownames(norDF) %in% resSig$id), ]

##heatmap plot
##plot heatmap
library("RColorBrewer")
library("gplots")
hmcol =  colorRampPalette(brewer.pal(9, "GnBu"))(100)
## expression heatmap
heatMapDF_nor <- t( apply(heatMapDf, 1, function(x){(x-mean(x))/sd(x)}) )

colnames(heatMapDF_nor) <- c('control1','control2',
                             'treat1'  , 'treat2')
#pdf('aaaaa.pdf', height = 10, width = 10)
heatmap.2(heatMapDF_nor, col = hmcol, trace="none", margin=c(6, 6),labRow = F)
#dev.off()
```


      </section>
    </div>

    
  </body>
</html>
